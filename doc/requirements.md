# app023: サウンドスケッチャー - 要件定義書

## 1. アプリ概要
キーボードタップでビートを刻み、簡易タイムライン（JSON/CSV）を書き出せる音楽スケッチツール。ミュージックビデオや映像編集の音楽プロトタイピングに最適。

## 2. 目的・課題

### 解決する課題
- ビート・リズムのアイデアを素早くスケッチしたい
- 映像編集時のタイミング合わせに使えるタイムラインが欲しい
- DAWを起動するほどではない簡単なビート作りが面倒
- ミュージックビデオ制作時のリズム感の共有が難しい

### 目的
- キーボード操作だけで直感的にビートを刻める
- タイミング情報をエクスポートして他ツールで活用
- 音楽制作・映像制作のプロトタイピングツールとして機能

## 3. ターゲットユーザー
- 映像クリエイター（ミュージックビデオ、動画編集）
- 音楽プロデューサー・トラックメイカー
- ビートメイカー初心者
- AI音楽生成を活用するクリエイター

## 4. 機能要件

### 4.1 必須機能（MVP）
- **キーボード演奏**
  - キーボードの特定キー（ASDFGHJK等）にドラム音を割り当て
  - リアルタイム音声再生
  - 最低4種類の音色（キック、スネア、ハイハット、クラップ等）

- **録音・再生**
  - 録音開始/停止
  - タップしたタイミングを記録
  - 録音した内容を再生

- **タイムライン表示**
  - 時間軸に沿って打ち込んだ音を可視化
  - 各音の種類を色分け表示
  - 再生位置の表示

- **エクスポート**
  - JSON形式でタイムライン書き出し
    ```json
    [
      {"time": 0.0, "sound": "kick"},
      {"time": 0.5, "sound": "snare"},
      {"time": 1.0, "sound": "hihat"}
    ]
    ```
  - CSV形式でも書き出し可能

### 4.2 拡張機能（優先度：中）
- **BPM設定**
  - テンポ設定（60〜240 BPM）
  - メトロノーム機能

- **グリッド機能**
  - 16分音符、8分音符等のグリッドにスナップ
  - 量子化（クオンタイズ）機能

- **音色カスタマイズ**
  - 音色ライブラリ（複数のドラムキット）
  - 音量調整

- **簡易編集**
  - タイムライン上の音符をクリックで削除
  - ドラッグで位置調整

### 4.3 将来的な拡張（優先度：低）
- MIDIファイルエクスポート
- 外部音源ファイルのインポート
- ループ再生機能
- 複数トラック対応

### 4.4 AI機能（Gemini API）
- **ビート補完・展開提案**
  - 録音したビートパターンをGemini APIで分析
  - 次の展開やバリエーションを提案
  - 「Aメロ→Bメロ」「イントロ→サビ」等の構成アイデア

- **ジャンル・スタイル判定**
  - 作成したビートのジャンルを自動判定（ヒップホップ/ロック/エレクトロ等）
  - 特徴的なリズムパターンを解説
  - 参考曲・アーティストの提案

- **メロディ・コード進行の提案**
  - ビートに合うメロディアイデアをテキストで提案
  - コード進行の候補を提示
  - 音楽理論的なアドバイス

- **改善アドバイス**
  - リズムの単調さを検出して改善案を提案
  - グルーヴ感を高めるためのヒント
  - プロのビートメイキングテクニックの提案

## 5. 非機能要件

### 5.1 パフォーマンス
- キー入力から音再生までのレイテンシ < 50ms
- 60秒間の録音データをスムーズに再生
- タイムライン描画が滑らか（60fps）

### 5.2 ユーザビリティ
- キーボードショートカット中心の操作
- 視覚的フィードバック（キー押下時のアニメーション）
- 直感的なタイムライン表示

### 5.3 データ管理
- 録音データのLocalStorage保存
- エクスポートしたファイルのダウンロード

## 6. 技術制約

### 6.1 環境要件
- モダンブラウザ対応（Web Audio API必須）
- デスクトップ優先（キーボード操作前提）
- オフライン動作可能

### 6.2 音声処理
- Web Audio API使用
- サンプル音源（wav/mp3）をプリロード
- 低レイテンシ再生の実装

### 6.3 データ形式
- タイムライン: JSON/CSV
- 時間精度: ミリ秒単位
- 音色: 文字列識別子

### 6.4 AI API仕様
- **使用API**: Google Gemini API
  - モデル: gemini-2.0-flash-exp
  - エンドポイント: Google AI Studio API

- **APIキー管理**
  - 保存場所: LocalStorage
  - 保存形式: 平文（暗号化なし）
  - キー名: `gemini_api_key`
  - 設定UI: アプリ内設定画面で登録・変更可能

- **起動時チェック**
  - APIキー未登録時は設定画面を表示
  - APIキー検証（簡易的な接続テスト）
  - エラーハンドリング（APIキー無効時の対応）

- **AI機能の利用**
  - AI機能はオプション（APIキーなしでも基本機能は利用可能）
  - API呼び出しエラー時の適切なフィードバック
  - レート制限への対応

## 7. 成功基準

### 7.1 機能面
- ✅ キーボードでリアルタイム演奏ができる
- ✅ 録音・再生がスムーズに動作
- ✅ タイムラインが視覚的に分かりやすい
- ✅ JSON/CSVエクスポートが正常動作

### 7.2 UX面
- ✅ 初心者でも5分以内に簡単なビートを作成できる
- ✅ キー入力のレスポンスが自然
- ✅ 直感的な操作感

### 7.3 技術面
- ✅ 音声レイテンシ < 50ms
- ✅ 60秒録音でも処理が軽快
- ✅ エクスポートデータが他ツールで利用可能

## 8. 制約事項・前提条件

### 8.1 制約事項
- キーボード操作前提（モバイル非対応）
- 音源はプリセットのみ（録音・インポート不可）
- 簡易的なタイミング記録（波形編集不可）

### 8.2 前提条件
- Web Audio API対応ブラウザ
- 物理キーボード接続環境
- JavaScript有効

## 9. UI/UX要求

### 9.1 デザイン方向性
- シンプルでクールなデザイン
- 音楽制作ツールらしいダークテーマ
- 視覚的フィードバック重視

### 9.2 主要画面
1. **メイン画面**
   - 上部: キーボードガイド（A=Kick, S=Snare等）
   - 中央: タイムライン表示
   - 下部: 録音/再生/停止ボタン、BPM設定、エクスポートボタン

2. **タイムライン**
   - 横軸: 時間（秒）
   - 縦軸: 音色種別
   - 各音をマーカーで表示（色分け）
   - 再生位置を示すカーソル

3. **キーボードガイド**
   - 各キーと割り当てられた音色を視覚的に表示
   - キー押下時にハイライト

## 10. スケジュール・優先度

### Phase 1（MVP）
- キーボード演奏機能
- 録音・再生
- タイムライン表示
- JSON/CSVエクスポート

### Phase 2（拡張）
- BPM設定・メトロノーム
- グリッド・量子化
- 音色カスタマイズ

### Phase 3（改善）
- 簡易編集機能
- UI/UXブラッシュアップ
- パフォーマンス最適化

## 11. キーボードマッピング（初期案）

```
A: Kick（バスドラム）
S: Snare（スネア）
D: Hihat Closed（クローズドハイハット）
F: Hihat Open（オープンハイハット）
J: Clap（クラップ）
K: Tom（タム）
L: Cymbal（シンバル）
;: Rim（リムショット）
```

Space: 録音開始/停止
Enter: 再生/停止
Backspace: クリア
